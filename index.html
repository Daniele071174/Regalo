<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mappa interattiva capitali d‚ÄôEuropa ‚úàÔ∏è</title>

  <!-- Leaflet (mappa) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#fff; }
    header {
      padding: 14px 16px;
      border-bottom: 1px solid #eee;
      background: #fff;
    }
    header h1 { margin:0; font-size: 18px; }
    header p { margin:6px 0 0; color:#555; font-size: 14px; line-height: 1.35; }
    .controls{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    input[type="search"]{
      flex: 1;
      min-width: 240px;
      padding:10px 12px;
      border:1px solid #ddd;
      border-radius:12px;
      font-size:14px;
    }
    button{
      padding:10px 12px;
      border:1px solid #ddd;
      border-radius:12px;
      background:#fafafa;
      cursor:pointer;
      font-size:14px;
    }

    #map { height: calc(100vh - 138px); }

    .popup h2 { margin:0 0 6px; font-size: 16px; }
    .popup p { margin:0 0 10px; color:#444; font-size: 13px; line-height:1.35; }
    .popup ol { margin:0 0 10px; padding-left: 18px; font-size: 13px; }
    .popup .links { display:flex; gap:8px; flex-wrap:wrap; }
    .popup a.btn {
      display:inline-block; padding:8px 10px;
      border:1px solid #ddd; border-radius:10px;
      text-decoration:none; font-size:12.5px; color:#111; background:#fafafa;
    }
    .tag { display:inline-block; font-size:12px; color:#666; margin-bottom:6px; }
  </style>
</head>
<body>
  <header>
    <h1>üéÅ Biglietto aereo open: scegli una capitale europea</h1>
    <p>Tocca un punto sulla mappa (capitale) per vedere descrizione e ‚ÄúTop 10‚Äù.</p>

    <div class="controls">
      <input id="search" type="search" placeholder="Cerca capitale o nazione (es. Roma, Italia, Oslo)..." />
      <button id="btnReset" type="button">Reset vista</button>
    </div>
  </header>

  <div id="map"></div>

  <script>
    // =========================
    // 1) DATI: CAPITALI EUROPEE
    // =========================
    // Lista di stati sovrani europei + microstati + Cipro + (incluso Kosovo).
    // Se vuoi includere/escludere Russia/Turchia/Kosovo lo facciamo dopo in 1 minuto.
    const capitali = [
      { country:"Albania", capital:"Tirana", lat:41.3275, lon:19.8187, desc:"Colorata e vivace, tra caff√®, musei e una scena urbana in crescita." },
      { country:"Andorra", capital:"Andorra la Vella", lat:42.5063, lon:1.5218, desc:"Capitale pi√π alta d‚ÄôEuropa: shopping, terme e montagne a due passi." },
      { country:"Austria", capital:"Vienna", lat:48.2082, lon:16.3738, desc:"Eleganza imperiale, musica classica e caff√® storici." },
      { country:"Belarus", capital:"Minsk", lat:53.9006, lon:27.5590, desc:"Ampie prospettive, architetture monumentali e parchi lungo il fiume." },
      { country:"Belgium", capital:"Brussels", lat:50.8503, lon:4.3517, desc:"Cuore europeo: Grand-Place, cioccolato, birre e musei." },
      { country:"Bosnia and Herzegovina", capital:"Sarajevo", lat:43.8563, lon:18.4131, desc:"Crocevia di culture: bazar, storia e panorami tra colline." },
      { country:"Bulgaria", capital:"Sofia", lat:42.6977, lon:23.3219, desc:"Tra cupole, rovine romane e una natura vicinissima." },
      { country:"Croatia", capital:"Zagreb", lat:45.8150, lon:15.9819, desc:"Atmosfera mitteleuropea, mercati e musei curiosi." },
      { country:"Cyprus", capital:"Nicosia", lat:35.1856, lon:33.3823, desc:"Unica capitale ancora divisa: mura veneziane e quartieri storici." },
      { country:"Czechia", capital:"Prague", lat:50.0755, lon:14.4378, desc:"Citt√† fiabesca di ponti e torri, perfetta a piedi." },
      { country:"Denmark", capital:"Copenhagen", lat:55.6761, lon:12.5683, desc:"Design, canali e hygge: una capitale super vivibile." },
      { country:"Estonia", capital:"Tallinn", lat:59.4370, lon:24.7536, desc:"Centro medievale magnifico e anima digitale." },
      { country:"Finland", capital:"Helsinki", lat:60.1699, lon:24.9384, desc:"Minimalismo nordico, saune e mare." },
      { country:"France", capital:"Paris", lat:48.8566, lon:2.3522, desc:"Iconica: arte, boulevard e scorci lungo la Senna." },
      { country:"Germany", capital:"Berlin", lat:52.5200, lon:13.4050, desc:"Creativa e storica: musei, street art e memoria del Novecento." },
      { country:"Greece", capital:"Athens", lat:37.9838, lon:23.7275, desc:"Antichit√† e vita contemporanea: l‚ÄôAcropoli domina tutto." },
      { country:"Hungary", capital:"Budapest", lat:47.4979, lon:19.0402, desc:"Due citt√† in una sul Danubio: terme, panorami e palazzi." },
      { country:"Iceland", capital:"Reykjav√≠k", lat:64.1466, lon:-21.9426, desc:"Porta verso natura estrema: geyser, aurore e design nordico." },
      { country:"Ireland", capital:"Dublin", lat:53.3498, lon:-6.2603, desc:"Pub, letteratura e passeggiate lungo il fiume Liffey." },
      { country:"Italy", capital:"Rome", lat:41.9028, lon:12.4964, desc:"Un museo a cielo aperto: antichit√†, piazze e cucina memorabile." },
      { country:"Kosovo", capital:"Pristina", lat:42.6629, lon:21.1655, desc:"Giovane e dinamica, con caff√®, monumenti moderni e storia recente." },
      { country:"Latvia", capital:"Riga", lat:56.9496, lon:24.1052, desc:"Art Nouveau e centro storico vivace sul Baltico." },
      { country:"Liechtenstein", capital:"Vaduz", lat:47.1410, lon:9.5209, desc:"Piccola, ordinata, con castello e vista alpina." },
      { country:"Lithuania", capital:"Vilnius", lat:54.6872, lon:25.2797, desc:"Barocco, cortili e un centro storico sorprendente." },
      { country:"Luxembourg", capital:"Luxembourg", lat:49.6116, lon:6.1319, desc:"Fortificazioni, gole verdi e atmosfera internazionale." },
      { country:"Malta", capital:"Valletta", lat:35.8989, lon:14.5146, desc:"Compatta e scenografica: bastioni, chiese e mare ovunque." },
      { country:"Moldova", capital:"Chi»ôinƒÉu", lat:47.0105, lon:28.8638, desc:"Parchi e viali larghi, ottima base per cantine e wine tour." },
      { country:"Monaco", capital:"Monaco", lat:43.7384, lon:7.4246, desc:"Glamour, vista mare e un centro storico arroccato." },
      { country:"Montenegro", capital:"Podgorica", lat:42.4304, lon:19.2594, desc:"Capitale tranquilla, comoda per esplorare montagne e costa." },
      { country:"Netherlands", capital:"Amsterdam", lat:52.3676, lon:4.9041, desc:"Canali, musei top e quartieri perfetti in bici." },
      { country:"North Macedonia", capital:"Skopje", lat:41.9981, lon:21.4254, desc:"Contrasti: bazar ottomano e architetture moderne." },
      { country:"Norway", capital:"Oslo", lat:59.9139, lon:10.7522, desc:"Fiordo, musei e natura a pochi minuti dal centro." },
      { country:"Poland", capital:"Warsaw", lat:52.2297, lon:21.0122, desc:"Rinata e moderna, con centro ricostruito e quartieri creativi." },
      { country:"Portugal", capital:"Lisbon", lat:38.7223, lon:-9.1393, desc:"Luce incredibile, tram storici e miradouros." },
      { country:"Romania", capital:"Bucharest", lat:44.4268, lon:26.1025, desc:"Eclettica: grandi viali, palazzi e vita notturna." },
      { country:"Russia", capital:"Moscow", lat:55.7558, lon:37.6173, desc:"Monumentale: piazze, metropolitana scenografica e musei." },
      { country:"San Marino", capital:"San Marino", lat:43.9424, lon:12.4578, desc:"Panorami e torri medievali su un monte iconico." },
      { country:"Serbia", capital:"Belgrade", lat:44.7866, lon:20.4489, desc:"Energia, storia e nightlife lungo Sava e Danubio." },
      { country:"Slovakia", capital:"Bratislava", lat:48.1486, lon:17.1077, desc:"Piccola e graziosa sul Danubio, perfetta per un weekend." },
      { country:"Slovenia", capital:"Ljubljana", lat:46.0569, lon:14.5058, desc:"Verde e romantica, con ponti e mercato sul fiume." },
      { country:"Spain", capital:"Madrid", lat:40.4168, lon:-3.7038, desc:"Solare e viva: musei, parchi e tapas." },
      { country:"Sweden", capital:"Stockholm", lat:59.3293, lon:18.0686, desc:"Isole, design e acqua dappertutto." },
      { country:"Switzerland", capital:"Bern", lat:46.9480, lon:7.4474, desc:"Elegante e raccolta: portici, Aare e atmosfera da fiaba." },
      { country:"Turkey", capital:"Ankara", lat:39.9334, lon:32.8597, desc:"Capitale moderna con musei importanti e quartieri autentici." },
      { country:"Ukraine", capital:"Kyiv", lat:50.4501, lon:30.5234, desc:"Cupole dorate, grandi viali e storia millenaria." },
      { country:"United Kingdom", capital:"London", lat:51.5074, lon:-0.1278, desc:"Multiculturale: musei, mercati e quartieri iconici." },
      { country:"Vatican City", capital:"Vatican City", lat:41.9029, lon:12.4534, desc:"Unico: arte e spiritualit√† nel cuore di Roma." }
    ];

    // =========================
    // 2) FUNZIONI POPUP: TOP 10
    // =========================
    function top10Template(capital, country) {
      // Template ‚ÄúTop 10‚Äù (sempre 10 voci). Poi lo personalizziamo capitale per capitale.
      return [
        "Passeggiata nel centro storico (punti iconici + stradine)",
        "Piazza principale e monumento simbolo",
        "Museo pi√π famoso / galleria d‚Äôarte",
        "Panorama dall‚Äôalto (collina/torre/skyline)",
        "Mercato tipico o food hall (assaggi locali)",
        "Quartiere pi√π caratteristico (foto + atmosfera)",
        "Parco grande / giardino botanico",
        "Luogo storico/imperdibile (castello, cattedrale, palazzo)",
        "Esperienza gastronomica tipica (piatto o dolce locale)",
        "Mini gita nei dintorni (mezza giornata)"
      ];
    }

    function popupHTML(c) {
      const list = top10Template(c.capital, c.country).map(x => `<li>${escapeHtml(x)}</li>`).join("");
      const q = encodeURIComponent(`10 cose da vedere a ${c.capital}`);
      const maps = encodeURIComponent(`${c.capital}, ${c.country}`);

      return `
        <div class="popup">
          <div class="tag">${escapeHtml(c.country)}</div>
          <h2>${escapeHtml(c.capital)}</h2>
          <p>${escapeHtml(c.desc)}</p>
          <ol>${list}</ol>
          <div class="links">
            <a class="btn" target="_blank" rel="noopener"
               href="https://www.google.com/search?q=${q}">üîé Top 10 specifico</a>
            <a class="btn" target="_blank" rel="noopener"
               href="https://www.google.com/maps/search/?api=1&query=${maps}">üó∫Ô∏è Apri su Maps</a>
          </div>
        </div>
      `;
    }

    function escapeHtml(s) {
      return String(s || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // =========================
    // 3) CREA LA MAPPA
    // =========================
    const map = L.map('map', { scrollWheelZoom: false }).setView([50.5, 12], 4);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Marker layer (utile per ricerca)
    const markers = [];

    function addCapital(c) {
      const marker = L.circleMarker([c.lat, c.lon], {
        radius: 6,
        weight: 1
      }).addTo(map);

      marker.bindPopup(popupHTML(c), { maxWidth: 340 });

      // Etichetta semplice (non ‚Äúdettagliata‚Äù): capitale visibile; nazione nel popup
      marker.bindTooltip(c.capital, { permanent: false, direction: "top", offset: [0, -6] });

      markers.push({ marker, data: c });
    }

    capitali.forEach(addCapital);

    // Vista iniziale su tutti i marker
    const bounds = L.latLngBounds(capitali.map(c => [c.lat, c.lon]));
    map.fitBounds(bounds.pad(0.12));

    // =========================
    // 4) RICERCA (capitale o paese)
    // =========================
    const search = document.getElementById("search");
    const btnReset = document.getElementById("btnReset");

    function resetView() {
      map.fitBounds(bounds.pad(0.12));
      search.value = "";
    }

    btnReset.addEventListener("click", resetView);

    search.addEventListener("input", () => {
      const q = search.value.trim().toLowerCase();
      if (!q) return;

      // trova primo match
      const hit = markers.find(m =>
        m.data.capital.toLowerCase().includes(q) ||
        m.data.country.toLowerCase().includes(q)
      );

      if (hit) {
        map.setView(hit.marker.getLatLng(), 7);
        hit.marker.openPopup();
      }
    });
  </script>
</body>
</html>

